// <reference types="node" />
export type StatResponse = {
  lastModified?: Date
  size: number
  metadata?: any
  type: string
  maxAge?: number
}

export type ReadOptions = {
  buffer?: boolean
}

export type WriteOptions = {
  metadata?: { [key: string]: string }
  type?: string
  maxAge?: number
}

export type WriteResponse = {
  filename: string
  bucket?: string
  path: string
  metadata: any
}

export type ListOptions = {
  recursive?: boolean
  pageSize?: number
  filter?: string
}

type ValidListeners = 'write' | 'remove' | 'copy' | '*'
export interface StorageEventHandler {
  (event: { name: 'write' | 'remove' | 'copy'; path: string; size: number }): void
}
type PathOrEmpty = `:${string}` | ''
export type ListenerPath = `${ValidListeners}${PathOrEmpty}`

export declare interface Storage {
  read: (path: string, options?: ReadOptions) => Promise<ReadableStream | Buffer | undefined>
  readBuffer: (path: string) => Promise<Buffer | undefined>
  write: (path: string, data: any, options?: WriteOptions) => Promise<WriteResponse>
  exists: (path: string) => Promise<boolean>
  stat: (path: string) => Promise<StatResponse | undefined>
  list: (path?: string | undefined, options?: ListOptions) => AsyncGenerator<string[]>
  move: (absPath: string, destPath: string) => Promise<void>
  on: (specifier: ListenerPath | ListenerPath[], handler: StorageEventHandler) => void
  copy: (absPath: string, destPath: string) => Promise<void>
  getUploadUrl: (path: string, options?: { expiresIn?: number }) => Promise<string>
  getDownloadUrl: (path: string, options?: { expiresIn?: number }) => Promise<string>
  remove: (absPath: string) => Promise<void>
  delete: (absPath: string) => Promise<void>
}

declare const storage: (bucket?: string) => Storage
export default storage
